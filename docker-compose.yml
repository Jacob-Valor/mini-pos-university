# ================================================================================================
# Mini POS - Docker Compose Configuration
# ================================================================================================
# This docker-compose file provides the database service for the Mini POS application.
# The application itself runs natively on all platforms (Windows, Linux, macOS).
#
# Usage:
#   Start database:        docker-compose up -d mariadb
#   Stop database:         docker-compose down
#   View logs:             docker-compose logs -f
#   Reset database:        docker-compose down -v (WARNING: Deletes all data!)
#
# For the application itself, run natively:
#   - Linux/macOS/Windows: dotnet run
#
# IMPORTANT: All sensitive values are loaded from .env file
#            Run: cp .env.example .env and update the values
# ================================================================================================

services:
  # ==============================================================================================
  # MariaDB Database Service
  # ==============================================================================================
  # Cross-platform database service that works on Windows, Linux, and macOS
  # via Docker Desktop. Sensitive configuration loaded from .env file.
  mariadb:
    image: mariadb:10.11
    container_name: mini_pos_db

    # Load ALL environment variables from .env file
    env_file:
      - .env

    # Database Configuration (values loaded from .env)
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
      MYSQL_DATABASE: ${DB_NAME}

    # Port Mapping
    ports:
      - "${DB_PORT}:3306"

    # Persistent Storage
    volumes:
      - mariadb_data:/var/lib/mysql
      - ./db/workshop.sql:/docker-entrypoint-initdb.d/workshop.sql

    networks:
      - pos_network

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "healthcheck.sh", "--connect", "--innodb_initialized"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s

# ================================================================================================
# Named Volumes
# ================================================================================================
volumes:
  mariadb_data:
    driver: local

# ================================================================================================
# Networks
# ================================================================================================
networks:
  pos_network:
    driver: bridge
